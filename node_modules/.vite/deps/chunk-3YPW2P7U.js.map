{
  "version": 3,
  "sources": ["../../@vaadin/a11y-base/src/aria-hidden.js", "../../@vaadin/a11y-base/src/aria-modal-controller.js"],
  "sourcesContent": ["/**\r\n * @license\r\n * Copyright (c) 2017 Anton Korzunov\r\n * SPDX-License-Identifier: MIT\r\n */\r\n\r\n/**\r\n * @fileoverview\r\n *\r\n * This module includes JS code copied from the `aria-hidden` package:\r\n * https://github.com/theKashey/aria-hidden/blob/master/src/index.ts\r\n */\r\n\r\n/** @type {WeakMap<Element, number>} */\r\nlet counterMap = new WeakMap();\r\n\r\n/** @type {WeakMap<Element, boolean>} */\r\nlet uncontrolledNodes = new WeakMap();\r\n\r\n/** @type {Record<string, WeakMap<Element, number>>} */\r\nlet markerMap = {};\r\n\r\n/** @type {number} */\r\nlet lockCount = 0;\r\n\r\n/**\r\n * @param {?Node} node\r\n * @return {boolean}\r\n */\r\nconst isElement = (node) => node && node.nodeType === Node.ELEMENT_NODE;\r\n\r\n/**\r\n * @param  {...unknown} args\r\n */\r\nconst logError = (...args) => {\r\n  console.error(`Error: ${args.join(' ')}. Skip setting aria-hidden.`);\r\n};\r\n\r\n/**\r\n * @param {HTMLElement} parent\r\n * @param {Element[]} targets\r\n * @return {Element[]}\r\n */\r\nconst correctTargets = (parent, targets) => {\r\n  if (!isElement(parent)) {\r\n    logError(parent, 'is not a valid element');\r\n    return [];\r\n  }\r\n\r\n  return targets\r\n    .map((target) => {\r\n      if (!isElement(target)) {\r\n        logError(target, 'is not a valid element');\r\n        return null;\r\n      }\r\n\r\n      let node = target;\r\n      while (node && node !== parent) {\r\n        if (parent.contains(node)) {\r\n          return target;\r\n        }\r\n        node = node.getRootNode().host;\r\n      }\r\n\r\n      logError(target, 'is not contained inside', parent);\r\n      return null;\r\n    })\r\n    .filter((x) => Boolean(x));\r\n};\r\n\r\n/**\r\n * Marks everything except given node(or nodes) as aria-hidden\r\n * @param {Element | Element[]} originalTarget - elements to keep on the page\r\n * @param {HTMLElement} [parentNode] - top element, defaults to document.body\r\n * @param {String} [markerName] - a special attribute to mark every node\r\n * @param {String} [controlAttribute] - html Attribute to control\r\n * @return {Function}\r\n */\r\nconst applyAttributeToOthers = (originalTarget, parentNode, markerName, controlAttribute) => {\r\n  const targets = correctTargets(parentNode, Array.isArray(originalTarget) ? originalTarget : [originalTarget]);\r\n\r\n  if (!markerMap[markerName]) {\r\n    markerMap[markerName] = new WeakMap();\r\n  }\r\n\r\n  const markerCounter = markerMap[markerName];\r\n\r\n  /** @type {Element[]} */\r\n  const hiddenNodes = [];\r\n\r\n  /** @type {Set<Node>} */\r\n  const elementsToKeep = new Set();\r\n\r\n  /** @type {Set<Node>} */\r\n  const elementsToStop = new Set(targets);\r\n\r\n  /**\r\n   * @param {?Node} el\r\n   */\r\n  const keep = (el) => {\r\n    if (!el || elementsToKeep.has(el)) {\r\n      return;\r\n    }\r\n\r\n    elementsToKeep.add(el);\r\n\r\n    const slot = el.assignedSlot;\r\n    if (slot) {\r\n      keep(slot);\r\n    }\r\n\r\n    keep(el.parentNode || el.host);\r\n  };\r\n\r\n  targets.forEach(keep);\r\n\r\n  /**\r\n   * @param {?Node} el\r\n   */\r\n  const deep = (parent) => {\r\n    if (!parent || elementsToStop.has(parent)) {\r\n      return;\r\n    }\r\n\r\n    const root = parent.shadowRoot;\r\n    const children = root ? [...parent.children, ...root.children] : [...parent.children];\r\n    children.forEach((node) => {\r\n      // Skip elements that don't need to be hidden\r\n      if (['template', 'script', 'style'].includes(node.localName)) {\r\n        return;\r\n      }\r\n\r\n      if (elementsToKeep.has(node)) {\r\n        deep(node);\r\n      } else {\r\n        const attr = node.getAttribute(controlAttribute);\r\n        const alreadyHidden = attr !== null && attr !== 'false';\r\n        const counterValue = (counterMap.get(node) || 0) + 1;\r\n        const markerValue = (markerCounter.get(node) || 0) + 1;\r\n\r\n        counterMap.set(node, counterValue);\r\n        markerCounter.set(node, markerValue);\r\n        hiddenNodes.push(node);\r\n\r\n        if (counterValue === 1 && alreadyHidden) {\r\n          uncontrolledNodes.set(node, true);\r\n        }\r\n\r\n        if (markerValue === 1) {\r\n          node.setAttribute(markerName, 'true');\r\n        }\r\n\r\n        if (!alreadyHidden) {\r\n          node.setAttribute(controlAttribute, 'true');\r\n        }\r\n      }\r\n    });\r\n  };\r\n\r\n  deep(parentNode);\r\n\r\n  elementsToKeep.clear();\r\n\r\n  lockCount += 1;\r\n\r\n  return () => {\r\n    hiddenNodes.forEach((node) => {\r\n      const counterValue = counterMap.get(node) - 1;\r\n      const markerValue = markerCounter.get(node) - 1;\r\n\r\n      counterMap.set(node, counterValue);\r\n      markerCounter.set(node, markerValue);\r\n\r\n      if (!counterValue) {\r\n        if (uncontrolledNodes.has(node)) {\r\n          uncontrolledNodes.delete(node);\r\n        } else {\r\n          node.removeAttribute(controlAttribute);\r\n        }\r\n      }\r\n\r\n      if (!markerValue) {\r\n        node.removeAttribute(markerName);\r\n      }\r\n    });\r\n\r\n    lockCount -= 1;\r\n\r\n    if (!lockCount) {\r\n      // clear\r\n      counterMap = new WeakMap();\r\n      counterMap = new WeakMap();\r\n      uncontrolledNodes = new WeakMap();\r\n      markerMap = {};\r\n    }\r\n  };\r\n};\r\n\r\n/**\r\n * Marks everything except given node(or nodes) as aria-hidden\r\n * @param {Element | Element[]} originalTarget - elements to keep on the page\r\n * @param {HTMLElement} [parentNode] - top element, defaults to document.body\r\n * @param {String} [markerName] - a special attribute to mark every node\r\n * @return {Function} undo command\r\n */\r\nexport const hideOthers = (originalTarget, parentNode = document.body, markerName = 'data-aria-hidden') => {\r\n  const targets = Array.from(Array.isArray(originalTarget) ? originalTarget : [originalTarget]);\r\n\r\n  if (parentNode) {\r\n    // We should not hide ariaLive elements - https://github.com/theKashey/aria-hidden/issues/10\r\n    targets.push(...Array.from(parentNode.querySelectorAll('[aria-live]')));\r\n  }\r\n\r\n  return applyAttributeToOthers(targets, parentNode, markerName, 'aria-hidden');\r\n};\r\n\r\n/**\r\n * Marks everything except given node(or nodes) as inert\r\n * @param {Element | Element[]} originalTarget - elements to keep on the page\r\n * @param {HTMLElement} [parentNode] - top element, defaults to document.body\r\n * @param {String} [markerName] - a special attribute to mark every node\r\n * @return {Function} undo command\r\n */\r\nexport const inertOthers = (originalTarget, parentNode = document.body, markerName = 'data-inert-ed') => {\r\n  return applyAttributeToOthers(originalTarget, parentNode, markerName, 'inert');\r\n};\r\n\r\n/**\r\n * @return if current browser supports inert\r\n */\r\nexport const supportsInert = 'inert' in HTMLElement.prototype;\r\n\r\n/**\r\n * Automatic function to \"suppress\" DOM elements - _hide_ or _inert_ in the best possible way\r\n * @param {Element | Element[]} originalTarget - elements to keep on the page\r\n * @param {HTMLElement} [parentNode] - top element, defaults to document.body\r\n * @param {String} [markerName] - a special attribute to mark every node\r\n * @return {Function} undo command\r\n */\r\nexport const suppressOthers = (originalTarget, parentNode, markerName) =>\r\n  (supportsInert ? inertOthers : hideOthers)(originalTarget, parentNode, markerName);\r\n", "/**\r\n * @license\r\n * Copyright (c) 2021 - 2025 Vaadin Ltd.\r\n * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/\r\n */\r\nimport { hideOthers } from './aria-hidden.js';\r\n\r\n/**\r\n * A controller for handling modal state on the elements with `dialog` and `alertdialog` role.\r\n * See https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Attributes/aria-modal\r\n *\r\n * Note, the actual `role` and `aria-modal` attributes are supposed to be handled by the\r\n * consumer web component. This is done in to ensure the controller only does one thing.\r\n */\r\nexport class AriaModalController {\r\n  /**\r\n   * @param {HTMLElement} host\r\n   */\r\n  constructor(host, callback) {\r\n    /**\r\n     * The controller host element.\r\n     *\r\n     * @type {HTMLElement}\r\n     */\r\n    this.host = host;\r\n\r\n    /**\r\n     * The callback used to detect which element\r\n     * to use as a target. Defaults to the host.\r\n     *\r\n     * @type {Function}\r\n     */\r\n    this.callback = typeof callback === 'function' ? callback : () => host;\r\n  }\r\n\r\n  /**\r\n   * Make the controller host modal by hiding other elements from screen readers\r\n   * using `aria-hidden` attribute (can be replaced with `inert` in the future).\r\n   *\r\n   * The method name is chosen to align with the one provided by native `<dialog>`:\r\n   * https://developer.mozilla.org/en-US/docs/Web/API/HTMLDialogElement/showModal\r\n   */\r\n  showModal() {\r\n    const targets = this.callback();\r\n    this.__showOthers = hideOthers(targets);\r\n  }\r\n\r\n  /**\r\n   * Remove `aria-hidden` from other elements unless there are any other\r\n   * controller hosts on the page activated by using `showModal()` call.\r\n   */\r\n  close() {\r\n    if (this.__showOthers) {\r\n      this.__showOthers();\r\n      this.__showOthers = null;\r\n    }\r\n  }\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
