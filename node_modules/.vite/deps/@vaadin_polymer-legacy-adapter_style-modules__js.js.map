{
  "version": 3,
  "sources": ["../../@vaadin/polymer-legacy-adapter/src/style-modules.js"],
  "sourcesContent": ["/**\r\n * @license\r\n * Copyright (c) 2021 - 2025 Vaadin Ltd.\r\n * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/\r\n */\r\nimport { DomModule } from '@polymer/polymer/lib/elements/dom-module.js';\r\nimport { stylesFromTemplate } from '@polymer/polymer/lib/utils/style-gather.js';\r\nimport { unsafeCSS } from 'lit';\r\nimport { __themeRegistry as themeRegistry } from '@vaadin/vaadin-themable-mixin';\r\n\r\n/**\r\n * @typedef CSSResult\r\n * @type {import('lit').CSSResult}\r\n *\r\n * @typedef DomModuleWithCachedStyles\r\n * @type {DomModule & {__allStyles?: CSSResult[], __partialStyles?: CSSResult[]}}\r\n */\r\n\r\nlet moduleIdIndex = 0;\r\n\r\n/**\r\n * Registers CSS styles for a component type. Make sure to register the styles before\r\n * the first instance of a component of the type is attached to DOM.\r\n *\r\n * @param {string} themeFor The local/tag name of the component type to register the styles for\r\n * @param {CSSResult[]} styles The CSS style rules to be registered for the component type\r\n * matching themeFor and included in the local scope of each component instance\r\n * @param {{moduleId?: string, include?: string | string[]}} options Additional options\r\n * @return {void}\r\n */\r\nfunction registerStyles(themeFor, styles = [], options = {}) {\r\n  const themeId = options.moduleId || `custom-style-module-${moduleIdIndex}`;\r\n  moduleIdIndex += 1;\r\n\r\n  /** @type {DomModuleWithCachedStyles} */\r\n  const module = document.createElement('dom-module');\r\n\r\n  if (themeFor) {\r\n    module.setAttribute('theme-for', themeFor);\r\n  }\r\n\r\n  // The styles array only needs to be included in the template in case options.moduleId is used,\r\n  // so that it's possible to include the styles by moduleId in some other <dom-module>\r\n  // (with <style include=\"module-id\">)\r\n  const includeStylesToTemplate = !!(styles.length && options.moduleId);\r\n\r\n  // Options.include may be undefined, string or an array of strings. Convert it to an array\r\n  const moduleIncludes = [].concat(options.include || []);\r\n  if (moduleIncludes.length === 0) {\r\n    // No includes are used so the styles array is considered complete and can be cached as is\r\n    module.__allStyles = styles;\r\n  } else if (!includeStylesToTemplate) {\r\n    // Includes are used so the styles array can be cached,\r\n    // but the included styles must be later added on top of it.\r\n    // Don't cache anything in case the styles will get included in the\r\n    // <dom-module> template anyways to avoid duplicate styles.\r\n    module.__partialStyles = styles;\r\n  }\r\n\r\n  module.innerHTML = `\r\n    <template>\r\n      ${moduleIncludes.map((include) => `<style include=${include}></style>`)}\r\n      ${includeStylesToTemplate ? `<style>${styles.map((style) => style.cssText).join('\\n')}</style>` : ''}\r\n    </template>\r\n  `;\r\n\r\n  module.register(themeId);\r\n}\r\n\r\n/**\r\n * Returns an array of CSS results obtained from the style module\r\n * @param {DomModule} module\r\n * @returns {CSSResult[]}\r\n */\r\nfunction getModuleStyles(module) {\r\n  return stylesFromTemplate(module.querySelector('template')).map((styleElement) => {\r\n    return unsafeCSS(styleElement.textContent);\r\n  });\r\n}\r\n\r\n/**\r\n * @typedef {Object} Theme\r\n * @property {string} themeFor\r\n * @property {CSSResult[]} styles\r\n * @property {string} [moduleId]\r\n */\r\n\r\n/**\r\n * Returns all the registered dom-modules mapped as themable-mixin -compatible Theme objects\r\n * @returns {Theme[]}\r\n */\r\nfunction getAllThemes() {\r\n  const domModule = DomModule;\r\n  const modules = domModule.prototype.modules;\r\n\r\n  return Object.keys(modules).map((moduleId) => {\r\n    /** @type {DomModuleWithCachedStyles} */\r\n    const module = modules[moduleId];\r\n    const themeFor = module.getAttribute('theme-for');\r\n    if (!module.__allStyles) {\r\n      module.__allStyles = getModuleStyles(module).concat(module.__partialStyles || []);\r\n    }\r\n\r\n    return {\r\n      themeFor,\r\n      moduleId,\r\n      styles: module.__allStyles,\r\n    };\r\n  });\r\n}\r\n\r\nif (!window.Vaadin) {\r\n  window.Vaadin = {};\r\n}\r\n\r\nwindow.Vaadin.styleModules = {\r\n  getAllThemes,\r\n  registerStyles,\r\n};\r\n\r\n// Convert any existing themes from the themable-mixin's themeRegistry to the style modules format\r\nif (themeRegistry && themeRegistry.length > 0) {\r\n  themeRegistry.forEach((theme) => {\r\n    registerStyles(theme.themeFor, theme.styles, {\r\n      moduleId: theme.moduleId,\r\n      include: theme.include,\r\n    });\r\n  });\r\n  // Clear the themeRegistry\r\n  themeRegistry.length = 0;\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;AAkBA,IAAI,gBAAgB;AAYpB,SAAS,eAAe,UAAU,SAAS,CAAC,GAAG,UAAU,CAAC,GAAG;AAC3D,QAAM,UAAU,QAAQ,YAAY,uBAAuB,aAAa;AACxE,mBAAiB;AAGjB,QAAM,SAAS,SAAS,cAAc,YAAY;AAElD,MAAI,UAAU;AACZ,WAAO,aAAa,aAAa,QAAQ;AAAA,EAC3C;AAKA,QAAM,0BAA0B,CAAC,EAAE,OAAO,UAAU,QAAQ;AAG5D,QAAM,iBAAiB,CAAC,EAAE,OAAO,QAAQ,WAAW,CAAC,CAAC;AACtD,MAAI,eAAe,WAAW,GAAG;AAE/B,WAAO,cAAc;AAAA,EACvB,WAAW,CAAC,yBAAyB;AAKnC,WAAO,kBAAkB;AAAA,EAC3B;AAEA,SAAO,YAAY;AAAA;AAAA,QAEb,eAAe,IAAI,CAAC,YAAY,kBAAkB,OAAO,WAAW,CAAC;AAAA,QACrE,0BAA0B,UAAU,OAAO,IAAI,CAAC,UAAU,MAAM,OAAO,EAAE,KAAK,IAAI,CAAC,aAAa,EAAE;AAAA;AAAA;AAIxG,SAAO,SAAS,OAAO;AACzB;AAOA,SAAS,gBAAgB,QAAQ;AAC/B,SAAO,mBAAmB,OAAO,cAAc,UAAU,CAAC,EAAE,IAAI,CAAC,iBAAiB;AAChF,WAAO,UAAU,aAAa,WAAW;AAAA,EAC3C,CAAC;AACH;AAaA,SAAS,eAAe;AACtB,QAAM,YAAY;AAClB,QAAM,UAAU,UAAU,UAAU;AAEpC,SAAO,OAAO,KAAK,OAAO,EAAE,IAAI,CAAC,aAAa;AAE5C,UAAM,SAAS,QAAQ,QAAQ;AAC/B,UAAM,WAAW,OAAO,aAAa,WAAW;AAChD,QAAI,CAAC,OAAO,aAAa;AACvB,aAAO,cAAc,gBAAgB,MAAM,EAAE,OAAO,OAAO,mBAAmB,CAAC,CAAC;AAAA,IAClF;AAEA,WAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA,QAAQ,OAAO;AAAA,IACjB;AAAA,EACF,CAAC;AACH;AAEA,IAAI,CAAC,OAAO,QAAQ;AAClB,SAAO,SAAS,CAAC;AACnB;AAEA,OAAO,OAAO,eAAe;AAAA,EAC3B;AAAA,EACA;AACF;AAGA,IAAI,iBAAiB,cAAc,SAAS,GAAG;AAC7C,gBAAc,QAAQ,CAAC,UAAU;AAC/B,mBAAe,MAAM,UAAU,MAAM,QAAQ;AAAA,MAC3C,UAAU,MAAM;AAAA,MAChB,SAAS,MAAM;AAAA,IACjB,CAAC;AAAA,EACH,CAAC;AAED,gBAAc,SAAS;AACzB;",
  "names": []
}
